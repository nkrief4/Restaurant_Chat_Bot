<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RestauBot | Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/dashboard.css" />
  <link rel="stylesheet" href="/static/stock_management.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
  <script src="/static/js/supabaseClient.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <script src="/static/js/dashboard.js" defer></script>
</head>

<body>
  <div class="dashboard-loading-overlay" id="dashboard-loading-overlay" role="status" aria-live="polite"
    aria-busy="true">
    <div class="loading-indicator">
      <span class="loading-spinner" aria-hidden="true"></span>
      <p>Chargement des donn√©es du dashboard‚Ä¶</p>
    </div>
  </div>
  <div class="dashboard">
    <aside class="sidebar" id="dashboard-sidebar" aria-label="Navigation principale">
      <div class="logo">
        <span class="logo-icon">RB</span>
        <div>
          <p class="logo-title">RestauBot</p>
          <p class="logo-subtitle">Assistant IA</p>
        </div>
      </div>
      <nav class="nav" aria-label="Navigation principale">
        <button type="button" class="nav-link active" data-section="overview">Vue d'ensemble</button>
        <button type="button" class="nav-link" data-section="restaurants">Restaurants</button>
        <button type="button" class="nav-link" data-section="manage-restaurants">G√©rer vos restaurants</button>
        <button type="button" class="nav-link" data-section="chatbot">Chatbot</button>
        <button type="button" class="nav-link" data-section="statistics">Statistiques</button>
        <div class="nav-dropdown" data-nav-dropdown="purchasing">
          <button type="button" class="nav-link nav-dropdown-toggle" data-section="purchasing" data-nav-dropdown-toggle
            aria-haspopup="true" aria-expanded="false">
            <span>Achats & Stock</span>
            <span class="nav-dropdown-icon" aria-hidden="true"></span>
          </button>
          <div class="nav-dropdown-menu" role="menu" aria-label="Acc√®s Achats & Stock">
            <button type="button" class="nav-sublink" data-section="purchasing" data-purchasing-view="dashboard"
              data-purchasing-nav-link role="menuitem">
              Dashboard Achats & Stock
            </button>
            <button type="button" class="nav-sublink" data-section="purchasing" data-purchasing-view="stock"
              data-purchasing-nav-link role="menuitem">
              Stock management
            </button>
            <button type="button" class="nav-sublink" data-section="purchasing" data-purchasing-view="dishes"
              data-purchasing-nav-link role="menuitem">
              Plats & recettes
            </button>
            <button type="button" class="nav-sublink" data-section="purchasing" data-purchasing-view="sales"
              data-purchasing-nav-link role="menuitem">
              Ventes par plat
            </button>
          </div>
        </div>
        <button type="button" class="nav-link" data-section="billing">Facturation & abonnement</button>
        <button type="button" class="nav-link" data-section="profile">Profil</button>
        <button type="button" class="nav-link nav-link-logout" id="logout-btn">
          <span class="logout-icon" aria-hidden="true"></span>
          <span>Se d√©connecter</span>
        </button>
      </nav>
      <div class="sidebar-footer">
        <p class="muted">Support premium</p>
        <a class="support-link" href="mailto:support@restaubot.ai">Nous contacter</a>
      </div>
    </aside>
    <div class="sidebar-backdrop" id="sidebar-backdrop" aria-hidden="true"></div>

    <main class="main">
      <header class="topbar">
        <button type="button" class="ghost-btn icon-btn sidebar-toggle" id="sidebar-toggle"
          aria-controls="dashboard-sidebar" aria-expanded="false">
          <span class="sr-only">Ouvrir le menu</span>
          <span class="sidebar-toggle-icon" aria-hidden="true"></span>
        </button>
        <div class="topbar-content">
          <p class="eyebrow">RestauBot</p>
          <h1 id="welcome-title">Bonjour</h1>
          <p class="subtitle" id="welcome-subtitle">G√©rez vos restaurants, vos conversations IA et votre abonnement en
            toute simplicit√©.</p>
        </div>
        <div class="topbar-actions">
          <div class="user-pill">
            <span class="user-name" id="user-pill-name">‚Äî</span>
            <span class="user-plan" id="user-plan-label">‚Äî</span>
          </div>
        </div>
      </header>

      <section id="overview" class="section active-section" aria-label="Vue d'ensemble">


        <div class="section-header overview-header">
          <div>
            <h2>Vue d'ensemble</h2>
            <p id="overview-range-label">P√©riode non d√©finie</p>
          </div>
          <div class="overview-header-right">
            <form id="date-range-form" class="range-filter" aria-label="Choisir la p√©riode analys√©e">
              <div class="filter-inputs">
                <label>
                  <span>Du</span>
                  <input type="date" id="filter-start-date" required />
                </label>
                <label>
                  <span>Au</span>
                  <input type="date" id="filter-end-date" required />
                </label>
              </div>
            </form>
            <p class="form-error" id="date-filter-message" role="status" aria-live="polite"></p>
            <div class="overview-meta">
              <div class="meta-pill">
                <span class="meta-label">Conversations / jour</span>
                <strong id="overview-average-per-day">‚Äî</strong>
              </div>
              <div class="meta-pill">
                <span class="meta-label">Messages / conversation</span>
                <strong id="overview-average-messages">‚Äî</strong>
              </div>
            </div>
          </div>
        </div>

        <div class="overview-layout">
          <div class="overview-main">
            <div class="kpi-grid overview-kpis">
              <article class="kpi-card">
                <p class="kpi-label">Restaurants</p>
                <h3 id="kpi-restaurants">‚Äî</h3>
                <p class="kpi-detail">√âtablissements connect√©s</p>
              </article>
              <article class="kpi-card">
                <p class="kpi-label">Conversations</p>
                <h3 id="kpi-conversations">‚Äî</h3>
                <p class="kpi-detail">Sessions IA sur la p√©riode</p>
              </article>
              <article class="kpi-card">
                <p class="kpi-label">Messages envoy√©s</p>
                <h3 id="kpi-messages">‚Äî</h3>
                <p class="kpi-detail">√âchanges cumul√©s client & bot</p>
              </article>
              <article class="kpi-card">
                <p class="kpi-label">Clients uniques</p>
                <h3 id="kpi-customers">‚Äî</h3>
                <p class="kpi-detail">Visiteurs accompagn√©s par RestauBot</p>
              </article>
            </div>

            <article class="card conversation-card">
              <div class="card-header">
                <div>
                  <h3>Activit√© des conversations</h3>
                  <p class="muted">√âvolution quotidienne sur la p√©riode s√©lectionn√©e.</p>
                </div>
              </div>
              <div class="chart-placeholder" aria-live="polite">
                <canvas id="overview-conversation-chart" role="img" aria-label="√âvolution quotidienne des conversations"
                  height="280"></canvas>
                <p class="chart-empty" id="overview-conversation-empty" hidden>Aucune donn√©e disponible sur cette
                  p√©riode.
                </p>
              </div>
            </article>

            <div class="overview-columns">
              <div class="overview-restaurants-block">
                <div class="overview-restaurants-header">
                  <h3>Vos √©tablissements</h3>
                  <p class="muted">Acc√©dez rapidement aux restaurants que vous g√©rez.</p>
                </div>
                <div id="overview-restaurant-cards" class="overview-restaurant-cards">
                  <p class="muted empty-state">Ajoutez un restaurant pour commencer.</p>
                </div>
              </div>

              <div class="overview-chat-wrapper">
                <div class="overview-chat-config">
                  <h3>Tester le chatbot</h3>
                  <label for="overview-restaurant-select">Choisissez un restaurant</label>
                  <select id="overview-restaurant-select" aria-label="S√©lectionner le restaurant pour le test">
                    <option value="">S√©lectionnez un restaurant</option>
                  </select>
                  <p class="form-hint" id="overview-chat-hint">S√©lectionnez un restaurant pour activer l'aper√ßu.</p>
                </div>
                <div class="overview-chat-preview" aria-live="polite">
                  <div class="chat-preview-body">
                    <div id="overview-chat-empty" class="chat-preview-empty">
                      <p>Choisissez un restaurant puis envoyez une question pour voir la r√©ponse de RestauBot.</p>
                    </div>
                    <div id="overview-chat-messages" class="chat-preview-messages"
                      aria-label="Historique de l'aper√ßu du chatbot"></div>
                  </div>
                  <form id="overview-chat-form" class="chat-preview-form" autocomplete="off">
                    <label class="sr-only" for="overview-chat-input">Votre message</label>
                    <input type="text" id="overview-chat-input" name="message"
                      placeholder="Demandez un menu, une allergie, un √©v√®nement‚Ä¶" autocomplete="off" />
                    <button type="submit" id="overview-chat-send" class="primary-btn">Envoyer</button>
                  </form>
                  <p class="form-hint" id="overview-chat-status"></p>
                </div>
              </div>
            </div>
          </div>

          <aside class="overview-sidebar">
            <article class="card insights-card">
              <div class="card-header">
                <div>
                  <h3>Restaurant le plus actif</h3>
                  <p class="muted">Bas√© sur le volume de conversations.</p>
                </div>
              </div>
              <p id="overview-top-restaurant" class="insight-value">‚Äî</p>
            </article>

            <article class="plan-card overview-plan-card">
              <div>
                <h3>Votre abonnement</h3>
                <p class="muted">R√©sum√© du plan en cours pour ce compte.</p>
              </div>
              <div class="plan-details">
                <p class="plan-name" id="overview-plan-name">‚Äî</p>
                <p class="muted" id="overview-plan-detail">‚Äî</p>
              </div>
            </article>

            <div class="overview-cta">
              <p>Besoin d'ajouter un nouvel √©tablissement&nbsp;?</p>
              <button type="button" class="primary-btn" data-open-section="manage-restaurants"
                data-open-tab="create">Cr√©er un restaurant</button>
            </div>
          </aside>
        </div>
      </section>

      <section id="restaurants" class="section" aria-label="Restaurants">
        <div class="section-header">
          <div>
            <h2>Vos restaurants</h2>
            <p>Visualisez vos √©tablissements et testez leur chatbot.</p>
          </div>
        </div>
        <button type="button" class="secondary-btn" data-open-section="manage-restaurants" data-open-tab="create">Cr√©er
          un nouveau restaurant</button>

        <div class="restaurants-grid" id="restaurants-card-list" aria-live="polite">
          <article class="restaurant-card loading-card">
            <div class="restaurant-card-header">
              <div class="skeleton name"></div>
              <span class="status-badge">Chargement‚Ä¶</span>
            </div>
            <p class="skeleton line"></p>
            <p class="skeleton line short"></p>
          </article>
        </div>
        <div class="sr-only" aria-live="polite" aria-atomic="true">
          <table>
            <tbody id="restaurants-table-body"></tbody>
          </table>
        </div>
        <div class="restaurants-cta">
          <div>
            <h3>Pr√™t √† ajouter un nouvel √©tablissement&nbsp;?</h3>
            <p class="muted">Connectez votre carte en quelques minutes pour entra√Æner RestauBot.</p>
          </div>
          <button type="button" class="primary-btn" data-open-section="manage-restaurants" data-open-tab="create">Cr√©er
            un restaurant</button>
        </div>
      </section>

      <section id="manage-restaurants" class="section" aria-label="Cr√©er ou modifier un restaurant">
        <div class="section-header">
          <div>
            <h2>G√©rer vos restaurants</h2>
            <p>Cr√©ez un nouvel √©tablissement ou mettez √† jour une fiche existante depuis le m√™me √©cran.</p>
          </div>
        </div>

        <div class="restaurant-management" data-restaurant-tabs>
          <div class="restaurant-tabs" role="tablist" aria-label="Choisir le mode de gestion">
            <button type="button" class="restaurant-tab is-active" role="tab" aria-selected="true" tabindex="0"
              id="restaurant-tab-create" aria-controls="restaurant-panel-create" data-restaurant-tab="create">
              Cr√©ation
            </button>
            <button type="button" class="restaurant-tab" role="tab" aria-selected="false" tabindex="-1"
              id="restaurant-tab-edit" aria-controls="restaurant-panel-edit" data-restaurant-tab="edit">
              Modification
            </button>
            <span class="restaurant-tab-indicator" data-tab-indicator aria-hidden="true"></span>
          </div>

          <div class="restaurant-panels" data-active-tab="create">
            <div class="restaurant-panel-track">
              <div class="restaurant-panel" id="restaurant-panel-create" role="tabpanel"
                aria-labelledby="restaurant-tab-create" data-tab-panel="create">
                <form class="form-grid restaurant-form" id="restaurant-create-form" data-form-type="create" novalidate>
                  <p class="form-mode" data-role="form-mode">Cr√©ation d'un nouvel √©tablissement.</p>
                  <label>
                    <span>Nom du restaurant</span>
                    <input type="text" name="display_name" placeholder="Ex : Le Jardin Secret" required />
                  </label>
                  <label>
                    <span>Slug public</span>
                    <input type="text" name="slug" placeholder="lejardin-secret" required />
                  </label>
                  <label>
                    <span>Langue principale</span>
                    <select disabled>
                      <option>Fran√ßais</option>
                    </select>
                  </label>
                  <label>
                    <span>Site web (optionnel)</span>
                    <input type="url" placeholder="https://monsite.com" disabled />
                  </label>
                  <label class="full-width">
                    <span>Menu structur√© (JSON)</span>
                    <textarea rows="6" name="menu_document" placeholder='{"categories": []}'></textarea>
                  </label>
                  <div class="upload-card full-width">
                    <div class="upload-card-header">
                      <div>
                        <h3>Analyser un fichier menu</h3>
                        <p class="muted">Importez un PDF ou une image, RestauBot le structurera automatiquement.</p>
                      </div>
                    </div>
                    <label class="upload-dropzone" data-role="menu-dropzone">
                      <input type="file" data-role="menu-file" accept="application/pdf,image/*"
                        aria-label="S√©lectionner un menu √† analyser" />
                      <div class="dropzone-illustration" aria-hidden="true"></div>
                      <div class="dropzone-copy">
                        <strong>Glissez-d√©posez votre menu</strong>
                        <span>ou cliquez pour parcourir vos fichiers</span>
                        <small>10 Mo maximum ¬∑ Formats PDF / image</small>
                      </div>
                    </label>
                    <div class="upload-preview" data-role="upload-preview">
                      <div class="preview-info" data-role="preview-info"
                        data-default-text="Aucun fichier import√© pour le moment.">
                        Aucun fichier import√© pour le moment.
                      </div>
                      <img src="/static/icones/image.svg" data-role="preview-image" alt="Aper√ßu du menu" hidden
                        width="18" height="18" />
                    </div>
                    <div class="upload-controls">
                      <button type="button" class="secondary-btn ai-upload-btn" data-action="upload-menu">
                        <span class="ai-btn-label" data-role="ai-btn-label">Analyser avec l'IA</span>
                        <span class="ai-glow" aria-hidden="true"></span>
                        <span class="ai-scanlines" aria-hidden="true"></span>
                      </button>
                    </div>
                    <p class="form-hint" data-role="menu-upload-status"></p>
                  </div>
                  <div class="form-footer">
                    <button type="submit" class="primary-btn" data-role="submit-btn">Enregistrer le restaurant</button>
                    <button type="button" class="ghost-btn" data-action="reset-form">R√©initialiser le
                      formulaire</button>
                    <p class="muted">Le restaurant appara√Ætra ensuite dans la liste ci-dessus et pourra √™tre test√© dans
                      la
                      section Chatbot.</p>
                    <p class="form-hint" data-role="form-message"></p>
                  </div>
                </form>
              </div>

              <div class="restaurant-panel" id="restaurant-panel-edit" role="tabpanel"
                aria-labelledby="restaurant-tab-edit" aria-hidden="true" data-tab-panel="edit">
                <div class="panel-intro">
                  <p class="form-mode" data-role="form-mode">Aucun restaurant s√©lectionn√© pour √©dition.</p>
                  <div class="panel-selector">
                    <label>
                      <span>S√©lectionner un restaurant</span>
                      <select id="edit-restaurant-select" data-role="restaurant-selector">
                        <option value="">S√©lectionnez un restaurant</option>
                      </select>
                    </label>
                    <p class="form-hint">Utilisez les cartes dans l'aper√ßu ou la liste ci-dessus pour pr√©-remplir ce
                      formulaire.</p>
                  </div>
                </div>

                <form class="form-grid restaurant-form is-idle" id="restaurant-edit-form" data-form-type="edit"
                  novalidate>
                  <label>
                    <span>Nom du restaurant</span>
                    <input type="text" name="display_name" placeholder="Ex : Le Jardin Secret" required />
                  </label>
                  <label>
                    <span>Slug public</span>
                    <input type="text" name="slug" placeholder="lejardin-secret" required />
                  </label>
                  <label>
                    <span>Langue principale</span>
                    <select disabled>
                      <option>Fran√ßais</option>
                    </select>
                  </label>
                  <label>
                    <span>Site web (optionnel)</span>
                    <input type="url" placeholder="https://monsite.com" disabled />
                  </label>
                  <label class="full-width">
                    <span>Menu structur√© (JSON)</span>
                    <textarea rows="6" name="menu_document" placeholder='{"categories": []}'></textarea>
                  </label>
                  <div class="upload-card full-width">
                    <div class="upload-card-header">
                      <div>
                        <h3>Analyser un fichier menu</h3>
                        <p class="muted">Importez un PDF ou une image, RestauBot le structurera automatiquement.</p>
                      </div>
                    </div>
                    <label class="upload-dropzone" data-role="menu-dropzone">
                      <input type="file" data-role="menu-file" accept="application/pdf,image/*"
                        aria-label="S√©lectionner un menu √† analyser" />
                      <div class="dropzone-illustration" aria-hidden="true"></div>
                      <div class="dropzone-copy">
                        <strong>Glissez-d√©posez votre menu</strong>
                        <span>ou cliquez pour parcourir vos fichiers</span>
                        <small>10 Mo maximum ¬∑ Formats PDF / image</small>
                      </div>
                    </label>
                    <div class="upload-preview" data-role="upload-preview">
                      <div class="preview-info" data-role="preview-info"
                        data-default-text="Aucun fichier import√© pour le moment.">
                        Aucun fichier import√© pour le moment.
                      </div>
                      <img data-role="preview-image" alt="Aper√ßu du menu" hidden />
                    </div>
                    <div class="upload-controls">
                      <button type="button" class="secondary-btn ai-upload-btn" data-action="upload-menu">
                        <span class="ai-btn-label" data-role="ai-btn-label">Analyser avec l'IA</span>
                        <span class="ai-glow" aria-hidden="true"></span>
                        <span class="ai-scanlines" aria-hidden="true"></span>
                      </button>
                    </div>
                    <p class="form-hint" data-role="menu-upload-status"></p>
                  </div>
                  <div class="form-footer">
                    <button type="submit" class="primary-btn" data-role="submit-btn">Mettre √† jour le
                      restaurant</button>
                    <button type="button" class="ghost-btn" data-action="reset-form">Terminer l'√©dition</button>
                    <p class="muted">Utilisez les cartes de la section Restaurants pour choisir l'√©tablissement √†
                      modifier.</p>
                    <p class="form-hint" data-role="form-message"></p>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="chatbot" class="section chatbot-section" aria-label="Espace chatbot">
        <div class="chatbot-shell">
          <div class="chatbot-header">
            <div class="chatbot-heading">
              <p class="eyebrow">RestauBot</p>
              <h2>Discutez avec votre assistant</h2>
              <p>Choisissez un √©tablissement, chargez son contexte puis testez vos sc√©narios en direct.</p>
            </div>
            <button type="button" class="chatbot-fullscreen-btn" id="chatbot-fullscreen-btn" data-open-chat disabled>
              Lancer en plein √©cran
            </button>
          </div>

          <div class="chatbot-toolbar" aria-describedby="chatbot-selection-hint">
            <div class="chatbot-select">
              <label for="chatbot-restaurant-select">Restaurant</label>
              <div class="chatbot-select-wrapper">
                <select id="chatbot-restaurant-select" aria-label="S√©lectionner le restaurant pour le chatbot">
                  <option value="">S√©lectionnez un restaurant</option>
                </select>
                <span class="chatbot-select-icon" aria-hidden="true"></span>
              </div>
            </div>
            <p class="chatbot-status-text" id="chatbot-selection-hint" role="status" aria-live="polite">
              Ajoutez un restaurant pour activer le chatbot.
            </p>
          </div>

          <div class="chatbot-surface" aria-live="polite">
            <div id="chatbot-thread" class="chatbot-thread" aria-label="Historique de la conversation"></div>
            <div id="chatbot-empty-state" class="chatbot-empty">
              <p>S√©lectionnez un restaurant puis dites bonjour √† votre assistant.</p>
            </div>
            <div id="chatbot-typing" class="chatbot-typing" role="status" aria-live="polite" hidden>
              <span class="typing-dot"></span>
              <span class="typing-dot"></span>
              <span class="typing-dot"></span>
            </div>
          </div>

          <form id="chatbot-form" class="chatbot-form" autocomplete="off">
            <label for="chatbot-input" class="sr-only">Votre message</label>
            <textarea id="chatbot-input" name="message" placeholder="Posez votre question‚Ä¶" rows="1" disabled
              required></textarea>
            <button type="submit" id="chatbot-send-btn" class="primary-btn" disabled>Envoyer</button>
          </form>
          <p id="chatbot-feedback" class="chatbot-feedback" role="status" aria-live="polite"></p>
        </div>
      </section>

      <section id="statistics" class="section" aria-label="Statistiques d√©taill√©es">
        <div class="section-header stats-section-header">
          <div>
            <h2>Statistiques d√©taill√©es</h2>
            <p id="statistics-range-label">Analyse des 7 derniers jours</p>
          </div>
          <p class="muted" id="statistics-selection-label">Tous vos √©tablissements</p>
        </div>

        <div class="stats-filter-panel" aria-label="Filtres d'analyse">
          <div class="stats-filter-block">
            <p class="filter-label">P√©riode analys√©e</p>
            <div class="stats-range-pills" role="group" aria-label="Choisir la p√©riode">
              <button type="button" class="range-pill active" data-stats-range="7">7 jours</button>
              <button type="button" class="range-pill" data-stats-range="30">30 jours</button>
              <button type="button" class="range-pill" data-stats-range="90">3 mois</button>
              <button type="button" class="range-pill" data-stats-range="180">6 mois</button>
            </div>
            <div class="stats-custom-range">
              <label>
                <span>Du</span>
                <input type="date" id="stats-start-date" />
              </label>
              <label>
                <span>Au</span>
                <input type="date" id="stats-end-date" />
              </label>
              <button type="button" class="ghost-btn" id="stats-apply-range">Appliquer</button>
              <p class="form-error" id="stats-range-message" role="status" aria-live="polite"></p>
            </div>
          </div>

          <div class="stats-filter-block">
            <p class="filter-label">Restaurants analys√©s</p>
            <div class="multi-select" id="stats-restaurant-picker">
              <button type="button" class="multi-select-trigger" id="stats-restaurant-toggle" aria-haspopup="true"
                aria-expanded="false">
                <span id="stats-selected-summary">Tous les restaurants</span>
                <span class="multi-select-caret" aria-hidden="true"></span>
              </button>
              <div class="multi-select-panel" id="stats-restaurant-panel" hidden>
                <div class="multi-select-search">
                  <input type="search" id="stats-restaurant-search" placeholder="Rechercher un √©tablissement" />
                </div>
                <div class="multi-select-actions">
                  <button type="button" data-action="select-all">Tout s√©lectionner</button>
                  <button type="button" data-action="clear-all">Effacer</button>
                </div>
                <ul class="multi-select-options" id="stats-restaurant-options" role="listbox"
                  aria-multiselectable="true">
                  <li class="muted">Aucun restaurant disponible.</li>
                </ul>
              </div>
            </div>
            <p class="form-hint" id="stats-selection-hint">Affichage global</p>
          </div>
        </div>

        <div class="kpi-grid stats-kpis">
          <article class="kpi-card">
            <p class="kpi-label">Conversations</p>
            <h3 id="stats-total-conversations">‚Äî</h3>
            <p class="kpi-detail">Volume global sur la p√©riode</p>
          </article>
          <article class="kpi-card">
            <p class="kpi-label">Messages √©chang√©s</p>
            <h3 id="stats-total-messages">‚Äî</h3>
            <p class="kpi-detail">Somme des messages clients et bot</p>
          </article>
          <article class="kpi-card">
            <p class="kpi-label">Conversations / jour</p>
            <h3 id="stats-average-per-day">‚Äî</h3>
            <p class="kpi-detail">Moyenne journali√®re</p>
          </article>
          <article class="kpi-card">
            <p class="kpi-label">Messages / conversation</p>
            <h3 id="stats-average-messages">‚Äî</h3>
            <p class="kpi-detail">Intensit√© moyenne des √©changes</p>
          </article>
          <article class="kpi-card">
            <p class="kpi-label">Restaurants actifs</p>
            <h3 id="stats-active-restaurants">‚Äî</h3>
            <p class="kpi-detail">√âtablissements avec des conversations</p>
          </article>
        </div>

        <div class="stats-visual-grid">
          <article class="card stats-chart-card">
            <div class="card-header">
              <div>
                <h3>Volume de conversations</h3>
                <p class="muted">Conversations et messages quotidiens.</p>
              </div>
            </div>
            <div class="chart-placeholder">
              <canvas id="stats-activity-chart" aria-label="√âvolution des conversations" role="img"
                height="280"></canvas>
              <p class="chart-empty" id="stats-activity-empty" hidden>Aucune interaction sur cette
                p√©riode.</p>
            </div>
          </article>

          <article class="card stats-breakdown-card">
            <div class="card-header">
              <div>
                <h3>R√©partition par restaurant</h3>
                <p class="muted">Poids des conversations sur la p√©riode.</p>
              </div>
            </div>
            <ul class="stats-breakdown-list" id="stats-restaurant-breakdown">
              <li class="muted">S√©lectionnez au moins un restaurant pour voir le d√©tail.</li>
            </ul>
          </article>

          <article class="card">
            <div class="card-header">
              <h3>Questions les plus pos√©es</h3>
              <p class="muted">Tendances d√©tect√©es automatiquement.</p>
            </div>
            <ul class="top-questions" id="stats-top-questions">
              <li>Collecte des tendances en cours‚Ä¶</li>
            </ul>
          </article>

          <article class="card chart-card">
            <div class="card-header">
              <h3>R√©gimes alimentaires</h3>
              <span class="badge">Top 5</span>
            </div>
            <div class="diet-chart" id="stats-diet-breakdown" aria-hidden="true"></div>
          </article>

          <article class="card">
            <div class="card-header">
              <h3>Restaurants les plus sollicit√©s</h3>
            </div>
            <ul class="busiest-list" id="stats-busiest-list">
              <li>En attente de donn√©es.</li>
            </ul>
          </article>

          <article class="card resolution-card">
            <div class="card-header">
              <h3>Taux de r√©solution</h3>
            </div>
            <p class="resolution-value" id="stats-resolution-rate">‚Äî</p>
            <p class="muted">Part des conversations cl√¥tur√©es automatiquement.</p>
          </article>
        </div>
      </section>

      <section id="billing" class="section" aria-label="Facturation et abonnement">
        <div class="section-header">
          <div>
            <h2>Facturation & abonnement</h2>
            <p>Suivez votre plan actuel et vos paiements r√©cents.</p>
          </div>
        </div>
        <div class="billing-grid">
          <article class="card">
            <h3>Plan actuel</h3>
            <p class="kpi-label" id="billing-plan-name">Plan Pro</p>
            <p class="muted" id="billing-plan-description">Plan Pro ‚Äî 5 restaurants inclus, assistance prioritaire.</p>
            <div class="plan-status">
              <p id="billing-next-payment">Prochain pr√©l√®vement le 12/11/2024</p>
              <button class="primary-btn">Mettre √† niveau</button>
            </div>
          </article>
          <article class="card">
            <h3>Historique des paiements</h3>
            <div class="table-wrapper compact">
              <table>
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Montant</th>
                    <th>Statut</th>
                  </tr>
                </thead>
                <tbody id="billing-history-body">
                  <tr>
                    <td colspan="4">Chargement des paiements‚Ä¶</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </article>
        </div>
      </section>

      <section id="profile" class="section" aria-label="Profil du compte">
        <div class="section-header">
          <div>
            <h2>Profil du compte</h2>
            <p>Identit√©, coordonn√©es et fuseau horaire sont utilis√©s pour les emails, horaires et m√©triques.</p>
          </div>
        </div>
        <form class="profile-form" id="profile-form" novalidate>
          <div class="form-grid">
            <label>
              <span>Nom & pr√©nom</span>
              <input type="text" id="profile-full-name" placeholder="Jean Dupont" autocomplete="name" />
              <p class="field-error" data-profile-error="full_name"></p>
            </label>
            <label>
              <span>Email (lecture seule)</span>
              <input type="email" id="profile-email" placeholder="jean.dupont@exemple.com" autocomplete="email"
                readonly />
            </label>
            <label>
              <span>Nom de l'entreprise</span>
              <input type="text" id="profile-company" placeholder="Groupe Saveurs" autocomplete="organization" />
            </label>
            <label>
              <span>Pays</span>
              <input type="text" id="profile-country" placeholder="France" autocomplete="country" />
            </label>
            <label>
              <span>T√©l√©phone</span>
              <input type="tel" id="profile-phone" placeholder="+33 1 23 45 67 89" autocomplete="tel" />
              <p class="field-error" data-profile-error="phone_number"></p>
            </label>
            <label>
              <span>Fuseau horaire</span>
              <select id="profile-timezone" required>
                <option value="">S√©lectionnez votre zone</option>
                <option value="Europe/Paris">Europe/Paris (UTC+1)</option>
                <option value="Europe/Brussels">Europe/Bruxelles (UTC+1)</option>
                <option value="Europe/Zurich">Europe/Zurich (UTC+1)</option>
                <option value="Europe/London">Europe/Londres (UTC+0)</option>
                <option value="America/Montreal">Am√©rique/Montr√©al (UTC-5)</option>
              </select>
              <p class="field-error" data-profile-error="timezone"></p>
            </label>
          </div>
          <div class="form-footer">
            <div class="profile-feedback" id="profile-form-message" role="status" aria-live="polite"></div>
            <div class="profile-actions">
              <button class="ghost-btn" type="reset">R√©initialiser</button>
              <button class="primary-btn" type="submit">Enregistrer les modifications</button>
            </div>
          </div>
        </form>
      </section>

      <section id="purchasing" class="section" aria-label="Achats et stock">
        <div class="purchasing-header">
          <div class="purchasing-header-actions">
            <!-- View switcher removed as requested -->
          </div>
        </div>

        <div class="purchasing-panel is-active" data-purchasing-panel="dashboard">
          <div class="purchasing-card-grid">
            <article class="purchasing-card">
              <div class="purchasing-card-head">
                <div>
                  <p class="purchasing-label">√âtape 1</p>
                  <h3>Restaurant actif</h3>
                </div>
                <button type="button" class="info-trigger"
                  data-tooltip="Synchronisez Achats & Stock avec l'√©tablissement s√©lectionn√© dans le dashboard."
                  aria-label="Informations sur le restaurant actif">
                  i
                </button>
              </div>
              <label class="purchasing-select" for="purchasing-section-restaurant-select">
                <span>Choisissez un √©tablissement</span>
                <select id="purchasing-section-restaurant-select">
                  <option value="">S√©lectionnez un restaurant</option>
                </select>
              </label>
              <p class="purchasing-card-hint">Le module Achats se met automatiquement √† jour selon votre choix.</p>
            </article>

            <article class="purchasing-card">
              <div class="purchasing-card-head">
                <div>
                  <p class="purchasing-label">√âtape 2</p>
                  <h3>Comprendre l'√©tat des stocks</h3>
                </div>
                <div class="purchasing-card-meta">
                  <span class="purchasing-status-pill is-sync">Temps r√©el</span>
                  <button type="button" class="info-trigger"
                    data-tooltip="Visualisez les alertes CRITICAL, LOW et OK pour prioriser vos achats."
                    aria-label="Informations sur l'√©tat des stocks">
                    i
                  </button>
                </div>
              </div>
              <p>Visualisez les recommandations d'achat, les niveaux critiques et les fournisseurs prioritaires sans
                quitter cette page.</p>
              <ul class="purchasing-card-list">
                <li>Alertes critiques mises en √©vidence</li>
                <li>Indicateurs LOW & OK lisibles imm√©diatement</li>
                <li>Glisser jusqu'au d√©tail complet des ingr√©dients</li>
              </ul>
            </article>

            <article class="purchasing-card">
              <div class="purchasing-card-head">
                <div>
                  <p class="purchasing-label">√âtape 3</p>
                  <h3>Besoin de plus d'espace ?</h3>
                </div>
                <div class="purchasing-card-meta">
                  <span class="purchasing-status-pill">Confort</span>
                  <button type="button" class="info-trigger"
                    data-tooltip="Passez en plein √©cran pour vos inventaires ou commandes volumineuses."
                    aria-label="Informations sur la vue plein √©cran">
                    i
                  </button>
                </div>
              </div>
              <p>Acc√©dez √† la version plein √©cran du module pour vos longues sessions de planification ou d'inventaire.
              </p>
              <a class="primary-btn" href="/purchasing" target="_blank" rel="noopener">Ouvrir en plein √©cran</a>
            </article>
          </div>

          <div class="purchasing-embed">
            <div class="purchasing-embed-head">
              <button type="button" class="info-trigger"
                data-tooltip="Toutes les interactions Achats & Stock restent dans cette fen√™tre, sans multiplier les onglets."
                aria-label="Informations sur le module Achats">
                i
              </button>
            </div>
            <div class="purchasing-iframe-shell" id="purchasing-iframe-shell">
              <div class="purchasing-iframe-loader" id="purchasing-iframe-loader" role="status" aria-live="polite">
                <span class="loader-dot" aria-hidden="true"></span>
                <p>Chargement du module Achats‚Ä¶</p>
              </div>
              <iframe id="purchasing-iframe" src="/purchasing?embedded=1" title="Module Achats & Stock" loading="lazy"
                referrerpolicy="no-referrer" class="purchasing-iframe"></iframe>
            </div>
          </div>
          <p class="muted purchasing-hint">Astuce : manipulez vos recettes et vos fournisseurs ici, puis ouvrez la vue
            plein √©cran pour vos cl√¥tures mensuelles.</p>
        </div>

        <div class="purchasing-panel" data-purchasing-panel="stock" hidden>
          <div class="stock-management-header">
            <div class="stock-header-left">
              <h2>Stock Management</h2>
              <p class="muted">Track and manage ingredient inventory in real-time.</p>
            </div>
            <div class="stock-header-actions">
              <button type="button" class="ghost-btn" id="add-ingredient-btn">Add New Ingredient</button>
              <button type="button" class="primary-btn">
                <span class="sparkle-icon">‚ú®</span>
                Get Purchasing Recommendations
              </button>
            </div>
          </div>

          <div class="stock-restaurant-selector">
            <label for="stock-restaurant-select">Select Restaurant</label>
            <select id="stock-restaurant-select">
              <option value="">Select a restaurant</option>
            </select>
          </div>

          <div class="stock-card">
            <div class="stock-filters">
              <div class="search-wrapper">
                <span class="search-icon">üîç</span>
                <input type="text" id="stock-search" placeholder="Search by Ingredient Name..." />
              </div>
              <div class="filter-dropdowns">
                <select id="stock-filter-status" class="filter-select">
                  <option value="">Status</option>
                  <option value="critical">Critical</option>
                  <option value="low">Low</option>
                  <option value="ok">OK</option>
                </select>
                <select id="stock-filter-category" class="filter-select">
                  <option value="">Category</option>
                  <option value="vegetables">Vegetables</option>
                  <option value="meat">Meat</option>
                  <option value="dairy">Dairy</option>
                  <option value="dry">Dry Goods</option>
                </select>
              </div>
            </div>

            <div class="stock-table-container">
              <table class="stock-table-new">
                <thead>
                  <tr>
                    <th>INGREDIENT NAME</th>
                    <th>CURRENT QUANTITY</th>
                    <th>SAFETY STOCK THRESHOLD</th>
                    <th>DAYS OF COVERAGE</th>
                    <th>STATUS</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="stock-table-body">
                  <!-- Rows will be populated by JS -->
                  <tr>
                    <td colspan="6" class="muted text-center">Select a restaurant to view stock.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <tr>
          <td>
            <div class="stock-item">
              <strong>Burrata des Pouilles</strong>
              <span>Livraison atelier frais</span>
            </div>
          </td>
          <td>
            <p class="stock-quantity">4 unit√©s</p>
            <span class="muted">Stock s√©curit√© 12</span>
          </td>
          <td>
            <span class="stock-status is-critical">Critique</span>
            <span class="muted">Commander avant 15h</span>
          </td>
          <td>
            <div class="stock-trend">
              <span class="trend-negative">-32 %</span>
              <small>D√©lais fournisseur 48 h</small>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="stock-item">
              <strong>Citron confit maison</strong>
              <span>Pr√©par√© atelier p√¢tisserie</span>
            </div>
          </td>
          <td>
            <p class="stock-quantity">9 pi√®ces</p>
            <span class="muted">Lot en fermentation</span>
          </td>
          <td>
            <span class="stock-status is-warning">√Ä surveiller</span>
            <span class="muted">Pr√™t dans 3 jours</span>
          </td>
          <td>
            <div class="stock-trend">
              <span class="trend-positive">+4 %</span>
              <small>Consommation stable</small>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="stock-item">
              <strong>Champignons shiitake</strong>
              <span>Producteur : For√™t B.</span>
            </div>
          </td>
          <td>
            <p class="stock-quantity">7 kg</p>
            <span class="muted">Livraison lundi</span>
          </td>
          <td>
            <span class="stock-status is-low">Faible</span>
            <span class="muted">Pr√©parer un rappel</span>
          </td>
          <td>
            <div class="stock-trend">
              <span class="trend-neutral">0 %</span>
              <small>Pr√©vision inchang√©e</small>
            </div>
          </td>
        </tr>
        </tbody>
        </table>
  </div>
  </div>

  <div class="purchasing-panel" data-purchasing-panel="dishes" hidden>
    <header class="purchasing-panel-head">
      <div>
        <p class="eyebrow">Plats & recettes</p>
        <h3>Visibilit√© sur les cr√©ations phares</h3>
      </div>
      <p class="muted">Anticipez la mise √† jour des fiches techniques avant chaque service.</p>
    </header>
    <div class="dish-grid">
      <article class="dish-card">
        <div class="dish-card-head">
          <h3>Raviole de homard</h3>
          <span class="dish-tag is-premium">Signature</span>
        </div>
        <p>Farce homard bleu, bisque cors√©e, √©cume de combava. Le plat d√©clenche 42 % des ventes premium.</p>
        <dl class="dish-metrics">
          <div>
            <dt>Disponibilit√©</dt>
            <dd>24 portions</dd>
          </div>
          <div>
            <dt>C.U. food cost</dt>
            <dd>17,30 ‚Ç¨</dd>
          </div>
          <div>
            <dt>Marge</dt>
            <dd>71 %</dd>
          </div>
        </dl>
        <p class="muted small">√Ä pr√©parer : bisque, raviole fra√Æche et herbes le matin.</p>
      </article>
      <article class="dish-card">
        <div class="dish-card-head">
          <h3>Risotto champignons anciens</h3>
          <span class="dish-tag is-stable">Incontournable</span>
        </div>
        <p>Fum√© au bois de h√™tre, nappage parmesan affin√© 24 mois. Plat le plus demand√© pour les menus affaires.</p>
        <dl class="dish-metrics">
          <div>
            <dt>Disponibilit√©</dt>
            <dd>38 portions</dd>
          </div>
          <div>
            <dt>C.U. food cost</dt>
            <dd>7,60 ‚Ç¨</dd>
          </div>
          <div>
            <dt>Marge</dt>
            <dd>82 %</dd>
          </div>
        </dl>
        <p class="muted small">V√©rifier le bouillon maison et les copeaux de parmesan le midi.</p>
      </article>
      <article class="dish-card">
        <div class="dish-card-head">
          <h3>Crumble de poire Safran</h3>
          <span class="dish-tag is-new">Nouveaut√©</span>
        </div>
        <p>Dessert cr√©√© pour la carte d'hiver. Id√©al pour booster les ventes √† l'issue du menu d√©gustation.</p>
        <dl class="dish-metrics">
          <div>
            <dt>Disponibilit√©</dt>
            <dd>30 portions</dd>
          </div>
          <div>
            <dt>C.U. food cost</dt>
            <dd>4,20 ‚Ç¨</dd>
          </div>
          <div>
            <dt>Marge</dt>
            <dd>79 %</dd>
          </div>
        </dl>
        <p class="muted small">Pr√©voir un briefing service pour pousser les ventes crois√©e avec les boissons chaudes.
        </p>
      </article>
    </div>
    <div class="dish-actions">
      <div>
        <h4>Brief cuisine</h4>
        <ul>
          <li>Mettre √† jour les fiches techniques dans RestauBot.</li>
          <li>Remont√©e √©quipe p√¢tisserie tous les vendredis.</li>
          <li>Suivre les plats signature versus nouveaut√©s.</li>
        </ul>
      </div>
      <div>
        <h4>Id√©es service</h4>
        <ul>
          <li>Proposer un accord vin blanc sur la raviole.</li>
          <li>Inclure le risotto en suggestion du jour.</li>
          <li>Vendre le crumble en menu d√©jeuner gourmand.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="purchasing-panel" data-purchasing-panel="sales" hidden>
    <header class="purchasing-panel-head">
      <div>
        <p class="eyebrow">Ventes par plat</p>
        <h3>Quel plat tire les revenus ?</h3>
      </div>
      <p class="muted">Suivez les volumes, le panier moyen et la dynamique des best-sellers.</p>
    </header>
    <div class="sales-summary-grid">
      <article class="sales-card">
        <p class="sales-label">Ventes 7 derniers jours</p>
        <strong>192 plats</strong>
        <span class="trend-positive">+14 %</span>
      </article>
      <article class="sales-card">
        <p class="sales-label">Panier moyen</p>
        <strong>52,80 ‚Ç¨</strong>
        <span class="trend-neutral">=</span>
      </article>
      <article class="sales-card">
        <p class="sales-label">Meilleure journ√©e</p>
        <strong>Samedi</strong>
        <span class="muted">74 couverts</span>
      </article>
    </div>
    <div class="sales-detail">
      <div class="sales-chart">
        <h4>Tendance hebdomadaire</h4>
        <div class="sales-chart-bars" aria-hidden="true">
          <span style="height: 45%" title="Lun"></span>
          <span style="height: 52%" title="Mar"></span>
          <span style="height: 61%" title="Mer"></span>
          <span style="height: 70%" title="Jeu"></span>
          <span style="height: 88%" title="Ven"></span>
          <span style="height: 100%" title="Sam"></span>
          <span style="height: 60%" title="Dim"></span>
        </div>
        <p class="muted small">Les volumes cumul√©s sont calcul√©s via les ventes saisies dans RestauBot.</p>
      </div>
      <div class="sales-table-wrapper">
        <table class="sales-table">
          <thead>
            <tr>
              <th>Plat</th>
              <th>Volumes</th>
              <th>Ticket moyen</th>
              <th>Conversion</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Raviole de homard</td>
              <td>54</td>
              <td>42 ‚Ç¨</td>
              <td><span class="trend-positive">+9 %</span></td>
            </tr>
            <tr>
              <td>Risotto champignons anciens</td>
              <td>68</td>
              <td>36 ‚Ç¨</td>
              <td><span class="trend-neutral">=</span></td>
            </tr>
            <tr>
              <td>Crumble de poire Safran</td>
              <td>34</td>
              <td>18 ‚Ç¨</td>
              <td><span class="trend-positive">+4 %</span></td>
            </tr>
            <tr>
              <td>Tartare de maigre</td>
              <td>36</td>
              <td>38 ‚Ç¨</td>
              <td><span class="trend-negative">-6 %</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  </section>
  </main>
  </div>

  <div class="modal" id="chatbot-modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-content qr-modal" role="document">
      <button class="modal-close" data-modal-close aria-label="Fermer le modal">&times;</button>
      <div>
        <p class="eyebrow">Partage client</p>
        <h3>QR code ‚Äî <span id="modal-restaurant-name">Nom du restaurant</span></h3>
        <p class="muted">Scannez ce QR code pour acc√©der au chatbot de l'√©tablissement.</p>
      </div>
      <div class="qr-modal-body">
        <div class="qr-visual" aria-live="polite">
          <div class="qr-frame">
            <img id="qr-code-image" alt="QR code du chatbot" loading="lazy" hidden />
            <div id="qr-code-placeholder" class="qr-placeholder">QR en pr√©paration‚Ä¶</div>
          </div>
          <p class="muted small">Le QR code se met √† jour automatiquement selon le restaurant s√©lectionn√©.</p>
        </div>
        <div class="qr-share">
          <label for="qr-share-link">Lien direct √† partager</label>
          <div class="qr-share-row">
            <input id="qr-share-link" type="text" readonly value="" />
            <button type="button" class="ghost-btn" data-action="copy-qr-link">Copier</button>
          </div>
          <p class="form-hint" id="qr-copy-status">&nbsp;</p>
          <button type="button" class="secondary-btn" data-action="open-qr-link">Ouvrir la page du chatbot</button>
        </div>
      </div>
    </div>
  </div>
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Add Ingredient Modal -->
  <div class="modal" id="add-ingredient-modal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal-overlay" data-modal-close></div>
    <div class="modal-content" role="document">
      <button class="modal-close" data-modal-close aria-label="Close modal">&times;</button>
      <div class="modal-header">
        <h3>Add New Ingredient</h3>
        <p class="muted">Add a new ingredient to your inventory.</p>
      </div>
      <form id="add-ingredient-form">
        <div class="form-group">
          <label for="ingredient-name">Name <span class="required">*</span></label>
          <input type="text" id="ingredient-name" name="name" required placeholder="e.g., Tomatoes" autocomplete="off">
        </div>
        <div class="form-group">
          <label for="ingredient-unit">Unit <span class="required">*</span></label>
          <select id="ingredient-unit" name="unit" required>
            <option value="">Select a unit</option>
            <option value="kg">kg (kilogram)</option>
            <option value="g">g (gram)</option>
            <option value="L">L (liter)</option>
            <option value="ml">ml (milliliter)</option>
            <option value="units">units</option>
            <option value="pcs">pcs (pieces)</option>
          </select>
        </div>
        <div class="form-footer">
          <button type="button" class="ghost-btn" data-modal-close>Cancel</button>
          <button type="submit" class="primary-btn">Add Ingredient</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/static/js/dashboard.js" type="module"></script>
</body>

</html>