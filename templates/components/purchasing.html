<section id="purchasing" class="section" aria-label="Achats et stock">
    <div class="purchasing-header">
        <div class="purchasing-header-actions">
            <!-- View switcher removed as requested -->
        </div>
    </div>

    <div class="purchasing-panel is-active" data-purchasing-panel="dashboard">
        <header class="purchasing-dashboard-head">
            <div>
                <p class="eyebrow">Pilotage</p>
                <h1>Dashboard Achats & Stock</h1>
                <p class="purchasing-dashboard-description">
                    Suivez vos stocks et vos achats en temps r√©el pour anticiper les besoins de vos √©quipes.
                </p>
            </div>
            <div class="purchasing-header-controls">
                <div class="purchasing-active-restaurant">
                    <p class="muted">Restaurant actif</p>
                    <strong id="purchasing-active-restaurant">Aucun</strong>
                </div>
            </div>
        </header>

        <!-- 1) KPIs Principaux -->
        <div class="purchasing-kpi-grid">
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-blue">
                    <span class="kpi-icon">üì¶</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Ingr√©dients en stock</p>
                    <h3 class="kpi-value" id="kpi-total-stock">-</h3>
                </div>
            </article>
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-orange">
                    <span class="kpi-icon">ü•ó</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Ventes totales</p>
                    <h3 class="kpi-value" id="kpi-total-sales">-</h3>
                </div>
            </article>
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-purple">
                    <span class="kpi-icon">üöö</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Commandes en cours</p>
                    <h3 class="kpi-value" id="kpi-active-orders">-</h3>
                </div>
            </article>
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-red">
                    <span class="kpi-icon">üö®</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Ruptures / Critiques</p>
                    <h3 class="kpi-value" id="kpi-critical-stock">-</h3>
                </div>
            </article>
        </div>

        <div class="purchasing-main-grid">
            <!-- 2) Liste des ingr√©dients critiques -->
            <section class="dashboard-block is-wide">
                <div class="block-header">
                    <h3>Ingr√©dients Critiques</h3>
                    <button type="button" class="ghost-btn small" data-purchasing-nav-link data-section="purchasing"
                        data-purchasing-view="stock">
                        Tout voir
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>Ingr√©dient</th>
                                <th>Stock actuel</th>
                                <th>Statut</th>
                                <th>Fournisseur</th>
                                <th>Recommand√©</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-critical-ingredients-body">
                            <tr>
                                <td colspan="6" class="text-center muted">Chargement...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 3) Commandes fournisseur r√©centes -->
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Commandes R√©centes</h3>
                </div>
                <div class="orders-list" id="dashboard-recent-orders-list">
                    <p class="text-center muted">Chargement...</p>
                </div>
            </section>
        </div>

        <!-- 4) Graphiques simples -->
        <div class="purchasing-charts-grid">
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Top Ventes par Plat</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chart-top-sales"></canvas>
                </div>
            </section>
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Top Ingr√©dients Consomm√©s</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chart-top-ingredients"></canvas>
                </div>
            </section>
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Commandes Fournisseurs</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chart-supplier-orders"></canvas>
                </div>
            </section>
        </div>
    </div>

    <div class="purchasing-panel" data-purchasing-panel="stock" hidden>
        <div class="stock-management-header">
            <div class="stock-header-left">
                <h1 class="stock-main-title">Stock Management</h1>
                <p class="muted">Track and manage ingredient inventory in real-time.</p>
            </div>
            <div class="stock-header-actions">
                <button type="button" class="secondary-btn" id="btn-add-ingredient">
                    <span class="icon">Ôºã</span>
                    Add New Ingredient
                </button>
                <button type="button" class="primary-btn">
                    <span class="sparkle-icon">ü§ñ</span>
                    Get Purchasing Recommendations
                </button>
            </div>
        </div>

        <div class="stock-toolbar">
            <div class="stock-toolbar-block active-restaurant-block">
                <p class="muted">Restaurant actif</p>
                <strong id="stock-active-restaurant">Aucun</strong>
            </div>
            <div class="stock-toolbar-block stock-toolbar-search">
                <label class="sr-only" for="stock-search">Rechercher un ingr√©dient</label>
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="stock-search" placeholder="Rechercher un ingr√©dient..." />
                </div>
            </div>
            <div class="stock-toolbar-block compact">
                <label for="stock-filter-status">Statut</label>
                <select id="stock-filter-status" class="filter-select">
                    <option value="">Tous les statuts</option>
                    <option value="critical">Critique</option>
                    <option value="low">Faible</option>
                    <option value="ok">Stable</option>
                </select>
            </div>
            <div class="stock-toolbar-block compact">
                <label for="stock-filter-category">Cat√©gorie</label>
                <select id="stock-filter-category" class="filter-select">
                    <option value="">Toutes les cat√©gories</option>
                </select>
            </div>
        </div>

        <div class="stock-card">
            <div class="stock-table-headline">
                <div>
                    <p class="eyebrow">Inventaire</p>
                    <h3>Liste des ingr√©dients</h3>
                </div>
                <div class="stock-status-overview" id="stock-status-overview" aria-live="polite"></div>
            </div>
            <div class="stock-table-container">
                <table class="stock-table-new">
                    <thead>
                        <tr>
                            <th>INGREDIENT NAME</th>
                            <th>CURRENT QUANTITY</th>
                            <th>DAYS OF COVERAGE</th>
                            <th>STATUS</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-body">
                        <!-- Rows will be populated by JS -->
                        <tr>
                            <td colspan="5" class="muted text-center">Utilisez le s√©lecteur global pour afficher le
                                stock.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ingredient Form Modal -->
        <div id="ingredient-form-modal" class="modal" hidden>
            <div class="modal-content modal-sheet add-ingredient-modal" role="dialog" aria-modal="true"
                aria-labelledby="ingredient-form-title">
                <div class="modal-sheet-header">
                    <div>
                        <p class="eyebrow" data-role="modal-eyebrow">Inventaire</p>
                        <h2 id="ingredient-form-title" data-role="modal-title">Ajouter un ingr√©dient</h2>
                        <p class="modal-sheet-description" data-role="modal-description">
                            Renseignez les informations cl√©s pour suivre ce produit dans vos stocks.
                        </p>
                    </div>
                    <button type="button" class="close-modal-btn" aria-label="Fermer la fen√™tre">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="ingredient-form" class="modal-sheet-body ingredient-form-body" novalidate>
                    <input type="hidden" id="ingredient-form-id" />
                    <div class="ingredient-form-layout">
                        <section class="ingredient-form-section">
                            <div class="ingredient-section-header">
                                <p class="eyebrow small">Profil</p>
                                <h3>Informations g√©n√©rales</h3>
                                <p class="muted">Nom, unit√© principale et cat√©gorie visuelle.</p>
                            </div>
                            <div class="ingredient-fields-grid">
                                <div class="modal-field-group">
                                    <label for="ingredient-name">Nom de l'ingr√©dient <span
                                            class="required-star">*</span></label>
                                    <input type="text" id="ingredient-name" required
                                        placeholder="Ex : Tomates, huile d'olive" autocomplete="off">
                                </div>
                                <div class="modal-field-group">
                                    <label for="ingredient-unit">Unit√© de mesure <span
                                            class="required-star">*</span></label>
                                    <select id="ingredient-unit" required>
                                        <option value="">Choisissez une unit√©‚Ä¶</option>
                                        <option value="kg">Kilogramme (kg)</option>
                                        <option value="g">Gramme (g)</option>
                                        <option value="l">Litre (l)</option>
                                        <option value="ml">Millilitre (ml)</option>
                                        <option value="pcs">Pi√®ces (pcs)</option>
                                    </select>
                                </div>
                                <div class="modal-field-group category-field">
                                    <label for="ingredient-category-select">Cat√©gorie</label>
                                    <div class="category-selector">
                                        <select id="ingredient-category-select">
                                            <option value="">Choisissez une cat√©gorie</option>
                                            <option value="__new__">Ajouter une cat√©gorie‚Ä¶</option>
                                        </select>
                                        <button type="button" class="ghost-btn category-new-btn"
                                            data-role="category-new-btn">Nouvelle cat√©gorie</button>
                                    </div>
                                    <input type="text" id="ingredient-category-input" class="category-input"
                                        placeholder="Nom de la nouvelle cat√©gorie" hidden>
                                    <p class="field-hint">S√©lectionnez une cat√©gorie existante ou cr√©ez-en une nouvelle.
                                    </p>
                                </div>
                            </div>
                        </section>
                        <section class="ingredient-form-section">
                            <div class="ingredient-section-header">
                                <p class="eyebrow small">Stocks</p>
                                <h3>Niveau disponible</h3>
                                <p class="muted">Saisissez la quantit√© actuelle et, si besoin, une estimation de
                                    couverture.</p>
                            </div>
                            <div class="ingredient-fields-grid">
                                <div class="modal-field-group">
                                    <label for="ingredient-current-stock">Stock actuel <span
                                            class="required-star">*</span></label>
                                    <input type="number" id="ingredient-current-stock" step="0.01" min="0" required
                                        placeholder="0,00">
                                </div>
                                <div class="modal-field-group">
                                    <label for="ingredient-coverage">Couverture estim√©e <span
                                            class="optional-badge">Optionnel</span></label>
                                    <input type="number" id="ingredient-coverage" step="1" min="0"
                                        placeholder="Nombre de jours">
                                    <p class="field-hint">Indiquez combien de jours le stock devrait couvrir vos
                                        besoins.</p>
                                </div>
                            </div>
                        </section>
                    </div>

                    <div class="modal-sheet-footer">
                        <button type="button" class="ghost-btn close-modal-btn">Annuler</button>
                        <button type="submit" class="primary-btn" data-role="modal-submit">Ajouter l'ingr√©dient</button>
                    </div>
                </form>
            </div>
        </div> -->
    </div>

    <div class="purchasing-panel" data-purchasing-panel="dishes" hidden>
        <!-- Recipes Header -->
        <header class="recipes-header">
            <div class="recipes-header-top">
                <div class="recipes-title-block">
                    <h1 class="recipes-main-title">Plats & Recettes</h1>
                    <p class="recipes-subtitle">Optimisez vos marges et g√©rez vos fiches techniques.</p>
                </div>
                <div class="recipes-header-actions">
                    <div class="recipes-active-restaurant">
                        <span>Restaurant actif</span>
                        <strong id="recipes-active-restaurant">Aucun</strong>
                    </div>
                    <button type="button" class="primary-btn" id="btn-add-recipe">
                        <span class="icon">Ôºã</span>
                        Nouveau Plat
                    </button>
                </div>
            </div>
            <div class="recipes-header-controls">
                <div class="recipes-search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="recipes-search" placeholder="Rechercher un plat..."
                        class="recipes-search-input">
                </div>
                <div class="recipes-filters">
                    <select id="recipes-category-filter" class="recipes-filter-select">
                        <option value="">Toutes les cat√©gories</option>
                        <option value="main">Plat principal</option>
                        <option value="appetizer">Entr√©e</option>
                        <option value="dessert">Dessert</option>
                        <option value="soup">Soupe</option>
                    </select>
                    <select id="recipes-sort" class="recipes-filter-select">
                        <option value="name">Nom (A-Z)</option>
                        <option value="margin">Marge (D√©croissant)</option>
                        <option value="cost">Co√ªt (Croissant)</option>
                        <option value="price">Prix (D√©croissant)</option>
                    </select>
                </div>
            </div>
        </header>

        <div class="recipes-layout" id="recipes-layout">
            <div class="recipes-list-panel" id="recipes-list-panel">
                <div class="recipes-table-wrapper">
                    <table class="recipes-table">
                        <thead>
                            <tr>
                                <th>Plat</th>
                                <th>Description</th>
                                <th class="text-right">Co√ªt</th>
                                <th class="text-right">Prix</th>
                                <th class="text-right">Marge</th>
                            </tr>
                        </thead>
                        <tbody id="recipes-table-body">
                            <tr>
                                <td colspan="5" class="text-center muted">
                                    Utilisez le s√©lecteur global pour voir les recettes.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <aside class="recipe-details-shell" id="recipe-details-shell" aria-live="polite" aria-hidden="true" hidden>
                <div class="recipe-details-card" id="recipe-details-card">
                    <!-- Loading Screen -->
                    <div class="recipe-loading-screen" id="recipe-loading-screen" hidden>
                        <div class="loading-spinner"></div>
                        <p class="loading-text">Chargement des donn√©es...</p>
                    </div>

                    <!-- Content (hidden during loading) -->
                    <div class="recipe-details-content" id="recipe-details-content">
                        <div class="recipe-details-header">
                            <div class="header-text-content">
                                <div class="editable-field" data-field="category">
                                    <p class="recipe-detail-category display-view" id="recipe-detail-category">Non
                                        cat√©goris√©</p>
                                    <input type="text" class="edit-view premium-input small" id="edit-recipe-category"
                                        placeholder="Cat√©gorie">
                                </div>
                                <div class="editable-field" data-field="name">
                                    <h2 class="display-view" id="recipe-detail-name">S√©lectionnez un plat</h2>
                                    <input type="text" class="edit-view premium-input large" id="edit-recipe-name"
                                        placeholder="Nom du plat">
                                </div>
                            </div>
                            <div class="recipe-details-header-actions">
                                <button type="button" class="ghost-btn icon-only" id="btn-collapse-details"
                                    aria-label="Fermer le panneau">
                                    <span aria-hidden="true">√ó</span>
                                </button>
                                <button type="button" class="recipe-edit-btn" id="btn-toggle-edit">
                                    <span class="icon-pencil" aria-hidden="true"></span>
                                    <span class="btn-text">Modifier</span>
                                </button>
                            </div>
                        </div>

                        <div class="recipe-stats-grid">
                            <article class="recipe-stat-card">
                                <p class="stat-label">Co√ªt production</p>
                                <strong id="recipe-detail-cost" class="display-view">‚Äî</strong>
                                <div class="edit-view cost-edit-stack">
                                    <div class="input-with-hint">
                                        <input type="number" step="0.01" id="edit-recipe-cost" class="premium-input"
                                            placeholder="0.00">
                                        <span class="input-hint">‚Ç¨</span>
                                    </div>
                                    <p class="cost-helper-text">Modifiez ce montant pour forcer un co√ªt manuel.</p>
                                </div>
                            </article>
                            <article class="recipe-stat-card editable-field" data-field="price">
                                <p class="stat-label">Prix de vente</p>
                                <strong id="recipe-detail-price" class="display-view">‚Äî</strong>
                                <input type="number" step="0.01" id="edit-recipe-price" class="edit-view premium-input"
                                    placeholder="0.00">
                            </article>
                            <article class="recipe-stat-card">
                                <p class="stat-label">Marge</p>
                                <strong id="recipe-detail-margin">‚Äî</strong>
                            </article>
                        </div>

                        <section class="recipe-section recipe-description-section">
                            <div class="recipe-section-header">
                                <div>
                                    <h3>Description</h3>
                                    <p class="muted small">Ingr√©dients cl√©s et storytelling du plat.</p>
                                </div>
                            </div>
                            <div class="recipe-description display-view" id="recipe-detail-description">
                                Ajoutez la description du plat depuis votre carte num√©rique.
                            </div>
                        </section>

                        <div class="recipe-edit-layout">
                            <section class="recipe-section recipe-ingredients-section">
                                <div class="recipe-section-header">
                                    <div>
                                        <h3>Ingr√©dients</h3>
                                    </div>
                                </div>

                                <!-- Display View: Read-only Table -->
                                <div class="recipe-ingredients-table display-view">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Nom</th>
                                                <th class="text-right">Quantit√©</th>
                                                <th class="text-right">Co√ªt</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recipe-ingredients-body">
                                            <tr>
                                                <td colspan="3" class="text-center muted">S√©lectionnez un plat.</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Edit View: Ingredient Manager -->
                                <div class="ingredients-manager edit-view">
                                    <div class="ingredients-header">
                                        <span>Ingr√©dient</span>
                                        <span>Quantit√©</span>
                                        <span>Unit√©</span>
                                        <span>Co√ªt</span>
                                        <span>Action</span>
                                    </div>
                                    <div id="edit-recipe-ingredients-list" class="ingredients-list">
                                        <!-- Dynamic content -->
                                    </div>
                                    <div class="add-ingredient-row">
                                        <select id="new-ingredient-select" class="ingredient-select">
                                            <option value="">Ajouter un ingr√©dient...</option>
                                        </select>
                                        <input type="number" id="new-ingredient-quantity" placeholder="Qt√©" step="0.01"
                                            min="0">
                                        <span class="unit-display" id="new-ingredient-unit">-</span>
                                        <button type="button" id="btn-add-ingredient" class="icon-btn success"
                                            title="Ajouter">
                                            <span>+</span>
                                        </button>
                                    </div>
                                </div>
                            </section>

                            <section class="recipe-section recipe-instructions-section editable-field"
                                data-field="instructions">
                                <div class="recipe-section-header">
                                    <div>
                                        <h3>Instructions</h3>
                                        <p class="muted small">Gardez vos √©tapes, variantes et dressages bien rang√©s.</p>
                                    </div>
                                </div>
                                <div class="recipe-instructions display-view" id="recipe-instructions">
                                    S√©lectionnez un plat pour afficher sa fiche.
                                </div>
                                <textarea id="edit-recipe-instructions" class="edit-view premium-input" rows="6"
                                    placeholder="Saisissez les √©tapes de pr√©paration..."></textarea>
                            </section>
                        </div>

                        <div class="recipe-secondary-actions">
                            <button type="button" class="ghost-btn" id="btn-cancel-edit">Annuler</button>
                            <button type="button" class="ghost-btn danger" id="btn-delete-recipe">Supprimer ce
                                plat</button>
                        </div>
                    </div>
                </div>

                <div class="purchasing-panel" data-purchasing-panel="sales" hidden>
                    <header class="purchasing-panel-head">
                        <div>
                            <p class="eyebrow">Ventes par plat</p>
                            <h3>Quel plat tire les revenus ?</h3>
                        </div>
                        <p class="muted">Suivez les volumes, le panier moyen et la dynamique des best-sellers.</p>
                    </header>
                    <div class="sales-summary-grid">
                        <article class="sales-card">
                            <p class="sales-label">Ventes 7 derniers jours</p>
                            <strong>192 plats</strong>
                            <span class="trend-positive">+14 %</span>
                        </article>
                        <article class="sales-card">
                            <p class="sales-label">Panier moyen</p>
                            <strong>52,80 ‚Ç¨</strong>
                            <span class="trend-neutral">=</span>
                        </article>
                        <article class="sales-card">
                            <p class="sales-label">Meilleure journ√©e</p>
                            <strong>Samedi</strong>
                            <span class="muted">74 couverts</span>
                        </article>
                    </div>
                    <div class="sales-detail">
                        <div class="sales-chart">
                            <h4>Tendance hebdomadaire</h4>
                            <div class="sales-chart-bars" aria-hidden="true">
                                <span style="height: 45%" title="Lun"></span>
                                <span style="height: 52%" title="Mar"></span>
                                <span style="height: 61%" title="Mer"></span>
                                <span style="height: 70%" title="Jeu"></span>
                                <span style="height: 88%" title="Ven"></span>
                                <span style="height: 100%" title="Sam"></span>
                                <span style="height: 60%" title="Dim"></span>
                            </div>
                            <p class="muted small">Les volumes cumul√©s sont calcul√©s via les ventes saisies dans
                                RestauBot.</p>
                        </div>
                        <div class="sales-table-wrapper">
                            <table class="sales-table">
                                <thead>
                                    <tr>
                                        <th>Plat</th>
                                        <th>Volumes</th>
                                        <th>Ticket moyen</th>
                                        <th>Conversion</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Raviole de homard</td>
                                        <td>54</td>
                                        <td>42 ‚Ç¨</td>
                                        <td><span class="trend-positive">+9 %</span></td>
                                    </tr>
                                    <tr>
                                        <td>Risotto champignons anciens</td>
                                        <td>68</td>
                                        <td>36 ‚Ç¨</td>
                                        <td><span class="trend-neutral">=</span></td>
                                    </tr>
                                    <tr>
                                        <td>Crumble de poire Safran</td>
                                        <td>34</td>
                                        <td>18 ‚Ç¨</td>
                                        <td><span class="trend-positive">+4 %</span></td>
                                    </tr>
                                    <tr>
                                        <td>Tartare de maigre</td>
                                        <td>36</td>
                                        <td>38 ‚Ç¨</td>
                                        <td><span class="trend-negative">-6 %</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
</section>
