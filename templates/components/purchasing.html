<section id="purchasing" class="section" aria-label="Achats et stock">
    <div class="purchasing-header">
        <div class="purchasing-header-actions">
            <!-- View switcher removed as requested -->
        </div>
    </div>

    <div class="purchasing-panel is-active" data-purchasing-panel="dashboard">
        <div class="purchasing-header-controls" style="margin-bottom: 24px;">
            <label class="purchasing-select" for="purchasing-section-restaurant-select">
                <select id="purchasing-section-restaurant-select">
                    <option value="">S√©lectionnez un restaurant</option>
                </select>
            </label>
        </div>

        <!-- 1) KPIs Principaux -->
        <div class="purchasing-kpi-grid">
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-blue">
                    <span class="kpi-icon">üì¶</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Ingr√©dients en stock</p>
                    <h3 class="kpi-value" id="kpi-total-stock">-</h3>
                </div>
            </article>
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-orange">
                    <span class="kpi-icon">‚ö†Ô∏è</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Sous safety stock</p>
                    <h3 class="kpi-value" id="kpi-low-stock">-</h3>
                </div>
            </article>
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-purple">
                    <span class="kpi-icon">üöö</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Commandes en cours</p>
                    <h3 class="kpi-value" id="kpi-active-orders">-</h3>
                </div>
            </article>
            <article class="kpi-card">
                <div class="kpi-icon-wrapper is-red">
                    <span class="kpi-icon">üö®</span>
                </div>
                <div class="kpi-content">
                    <p class="kpi-label">Ruptures / Critiques</p>
                    <h3 class="kpi-value" id="kpi-critical-stock">-</h3>
                </div>
            </article>
        </div>

        <div class="purchasing-main-grid">
            <!-- 2) Liste des ingr√©dients critiques -->
            <section class="dashboard-block is-wide">
                <div class="block-header">
                    <h3>Ingr√©dients Critiques</h3>
                    <button type="button" class="ghost-btn small" data-purchasing-nav-link data-section="purchasing"
                        data-purchasing-view="stock">
                        Tout voir
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="dashboard-table">
                        <thead>
                            <tr>
                                <th>Ingr√©dient</th>
                                <th>Stock actuel</th>
                                <th>Safety Stock</th>
                                <th>Statut</th>
                                <th>Fournisseur</th>
                                <th>Recommand√©</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-critical-ingredients-body">
                            <tr>
                                <td colspan="6" class="text-center muted">Chargement...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 3) Commandes fournisseur r√©centes -->
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Commandes R√©centes</h3>
                </div>
                <div class="orders-list" id="dashboard-recent-orders-list">
                    <p class="text-center muted">Chargement...</p>
                </div>
            </section>
        </div>

        <!-- 4) Graphiques simples -->
        <div class="purchasing-charts-grid">
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Top Ventes par Plat</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chart-top-sales"></canvas>
                </div>
            </section>
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Top Ingr√©dients Consomm√©s</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chart-top-ingredients"></canvas>
                </div>
            </section>
            <section class="dashboard-block">
                <div class="block-header">
                    <h3>Commandes Fournisseurs</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chart-supplier-orders"></canvas>
                </div>
            </section>
        </div>
    </div>

    <div class="purchasing-panel" data-purchasing-panel="stock" hidden>
        <div class="stock-management-header">
            <div class="stock-header-left">
                <h1 class="stock-main-title">Stock Management</h1>
                <p class="muted">Track and manage ingredient inventory in real-time.</p>
            </div>
            <div class="stock-header-actions">
                <button type="button" class="secondary-btn" id="btn-add-ingredient">
                    <span class="icon">Ôºã</span>
                    Add New Ingredient
                </button>
                <button type="button" class="primary-btn">
                    <span class="sparkle-icon">ü§ñ</span>
                    Get Purchasing Recommendations
                </button>
            </div>
        </div>

        <div class="stock-restaurant-selector">
            <label for="stock-restaurant-select">Select Restaurant</label>
            <select id="stock-restaurant-select">
                <option value="">Select a restaurant</option>
            </select>
        </div>

        <div class="stock-card">
            <div class="stock-filters">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="stock-search" placeholder="Search by Ingredient Name..." />
                </div>
                <div class="filter-dropdowns">
                    <select id="stock-filter-status" class="filter-select">
                        <option value="">Status</option>
                        <option value="critical">Critical</option>
                        <option value="low">Low</option>
                        <option value="ok">OK</option>
                    </select>
                    <select id="stock-filter-category" class="filter-select">
                        <option value="">Category</option>
                        <option value="vegetables">Vegetables</option>
                        <option value="meat">Meat</option>
                        <option value="dairy">Dairy</option>
                        <option value="dry">Dry Goods</option>
                    </select>
                </div>
            </div>

            <div class="stock-table-container">
                <table class="stock-table-new">
                    <thead>
                        <tr>
                            <th>INGREDIENT NAME</th>
                            <th>CURRENT QUANTITY</th>
                            <th>DAYS OF COVERAGE</th>
                            <th>STATUS</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-body">
                        <!-- Rows will be populated by JS -->
                        <tr>
                            <td colspan="5" class="muted text-center">Select a restaurant to view stock.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Edit Ingredient Modal -->
        <div id="edit-ingredient-modal" class="modal" hidden>
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Ingredient</h3>
                    <button type="button" class="close-modal-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="edit-ingredient-form">
                        <input type="hidden" id="edit-ingredient-id">
                        <div class="form-group">
                            <label for="edit-ingredient-name">Ingredient Name</label>
                            <input type="text" id="edit-ingredient-name" disabled class="disabled-input">
                        </div>
                        <div class="form-group">
                            <label for="edit-safety-stock">Safety Stock Threshold</label>
                            <p class="help-text">Quantity below which the status becomes CRITICAL.</p>
                            <div class="input-with-unit">
                                <input type="number" id="edit-safety-stock" step="0.1" min="0" required>
                                <span id="edit-ingredient-unit" class="unit-badge">kg</span>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="ghost-btn close-modal-btn">Cancel</button>
                            <button type="submit" class="primary-btn">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Add Ingredient Modal -->
        <div id="add-ingredient-modal" class="modal" hidden>
            <div class="modal-content add-ingredient-modal-content">
                <div class="modal-header">
                    <div class="modal-header-icon">
                        <span class="modal-icon">üì¶</span>
                    </div>
                    <div>
                        <h3>Add New Ingredient</h3>
                        <p class="muted">Add a new ingredient to your inventory</p>
                    </div>
                    <button type="button" class="close-modal-btn">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="add-ingredient-form">
                        <div class="form-group">
                            <label for="add-ingredient-name">
                                <span class="label-icon">üè∑Ô∏è</span>
                                Ingredient Name
                            </label>
                            <input type="text" id="add-ingredient-name" required
                                placeholder="e.g., Tomatoes, Olive Oil, Flour...">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="add-ingredient-unit">
                                    <span class="label-icon">‚öñÔ∏è</span>
                                    Unit
                                </label>
                                <select id="add-ingredient-unit" required>
                                    <option value="kg">Kilogram (kg)</option>
                                    <option value="g">Gram (g)</option>
                                    <option value="l">Liter (l)</option>
                                    <option value="ml">Milliliter (ml)</option>
                                    <option value="pcs">Pieces (pcs)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="add-ingredient-quantity">
                                    <span class="label-icon">üìä</span>
                                    Current Quantity
                                </label>
                                <input type="number" id="add-ingredient-quantity" step="0.01" min="0" required
                                    placeholder="0.00">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="add-safety-stock">
                                    <span class="label-icon">‚ö†Ô∏è</span>
                                    Safety Stock
                                </label>
                                <input type="number" id="add-safety-stock" step="0.01" min="0" required
                                    placeholder="0.00">
                                <p class="help-text">Minimum quantity before alert</p>
                            </div>
                            <div class="form-group">
                                <label for="add-ingredient-coverage">
                                    <span class="label-icon">üìÖ</span>
                                    Days of Coverage
                                </label>
                                <input type="number" id="add-ingredient-coverage" step="1" min="0"
                                    placeholder="Optional">
                                <p class="help-text">Estimated days until reorder</p>
                            </div>
                        </div>

                        <div class="modal-actions">
                            <button type="button" class="ghost-btn close-modal-btn">Cancel</button>
                            <button type="submit" class="primary-btn">
                                <span class="btn-icon">‚úì</span>
                                Add Ingredient
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="purchasing-panel" data-purchasing-panel="dishes" hidden>
        <header class="purchasing-panel-head">
            <div>
                <p class="eyebrow">Plats & recettes</p>
                <h3>Visibilit√© sur les cr√©ations phares</h3>
            </div>
            <p class="muted">Anticipez la mise √† jour des fiches techniques avant chaque service.</p>
        </header>
        <div class="dish-grid">
            <article class="dish-card">
                <div class="dish-card-head">
                    <h3>Raviole de homard</h3>
                    <span class="dish-tag is-premium">Signature</span>
                </div>
                <p>Farce homard bleu, bisque cors√©e, √©cume de combava. Le plat d√©clenche 42 % des ventes premium.</p>
                <dl class="dish-metrics">
                    <div>
                        <dt>Disponibilit√©</dt>
                        <dd>24 portions</dd>
                    </div>
                    <div>
                        <dt>C.U. food cost</dt>
                        <dd>17,30 ‚Ç¨</dd>
                    </div>
                    <div>
                        <dt>Marge</dt>
                        <dd>71 %</dd>
                    </div>
                </dl>
                <p class="muted small">√Ä pr√©parer : bisque, raviole fra√Æche et herbes le matin.</p>
            </article>
            <article class="dish-card">
                <div class="dish-card-head">
                    <h3>Risotto champignons anciens</h3>
                    <span class="dish-tag is-stable">Incontournable</span>
                </div>
                <p>Fum√© au bois de h√™tre, nappage parmesan affin√© 24 mois. Plat le plus demand√© pour les menus affaires.
                </p>
                <dl class="dish-metrics">
                    <div>
                        <dt>Disponibilit√©</dt>
                        <dd>38 portions</dd>
                    </div>
                    <div>
                        <dt>C.U. food cost</dt>
                        <dd>7,60 ‚Ç¨</dd>
                    </div>
                    <div>
                        <dt>Marge</dt>
                        <dd>82 %</dd>
                    </div>
                </dl>
                <p class="muted small">V√©rifier le bouillon maison et les copeaux de parmesan le midi.</p>
            </article>
            <article class="dish-card">
                <div class="dish-card-head">
                    <h3>Crumble de poire Safran</h3>
                    <span class="dish-tag is-new">Nouveaut√©</span>
                </div>
                <p>Dessert cr√©√© pour la carte d'hiver. Id√©al pour booster les ventes √† l'issue du menu d√©gustation.</p>
                <dl class="dish-metrics">
                    <div>
                        <dt>Disponibilit√©</dt>
                        <dd>30 portions</dd>
                    </div>
                    <div>
                        <dt>C.U. food cost</dt>
                        <dd>4,20 ‚Ç¨</dd>
                    </div>
                    <div>
                        <dt>Marge</dt>
                        <dd>79 %</dd>
                    </div>
                </dl>
                <p class="muted small">Pr√©voir un briefing service pour pousser les ventes crois√©e avec les boissons
                    chaudes.
                </p>
            </article>
        </div>
        <div class="dish-actions">
            <div>
                <h4>Brief cuisine</h4>
                <ul>
                    <li>Mettre √† jour les fiches techniques dans RestauBot.</li>
                    <li>Remont√©e √©quipe p√¢tisserie tous les vendredis.</li>
                    <li>Suivre les plats signature versus nouveaut√©s.</li>
                </ul>
            </div>
            <div>
                <h4>Id√©es service</h4>
                <ul>
                    <li>Proposer un accord vin blanc sur la raviole.</li>
                    <li>Inclure le risotto en suggestion du jour.</li>
                    <li>Vendre le crumble en menu d√©jeuner gourmand.</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="purchasing-panel" data-purchasing-panel="sales" hidden>
        <header class="purchasing-panel-head">
            <div>
                <p class="eyebrow">Ventes par plat</p>
                <h3>Quel plat tire les revenus ?</h3>
            </div>
            <p class="muted">Suivez les volumes, le panier moyen et la dynamique des best-sellers.</p>
        </header>
        <div class="sales-summary-grid">
            <article class="sales-card">
                <p class="sales-label">Ventes 7 derniers jours</p>
                <strong>192 plats</strong>
                <span class="trend-positive">+14 %</span>
            </article>
            <article class="sales-card">
                <p class="sales-label">Panier moyen</p>
                <strong>52,80 ‚Ç¨</strong>
                <span class="trend-neutral">=</span>
            </article>
            <article class="sales-card">
                <p class="sales-label">Meilleure journ√©e</p>
                <strong>Samedi</strong>
                <span class="muted">74 couverts</span>
            </article>
        </div>
        <div class="sales-detail">
            <div class="sales-chart">
                <h4>Tendance hebdomadaire</h4>
                <div class="sales-chart-bars" aria-hidden="true">
                    <span style="height: 45%" title="Lun"></span>
                    <span style="height: 52%" title="Mar"></span>
                    <span style="height: 61%" title="Mer"></span>
                    <span style="height: 70%" title="Jeu"></span>
                    <span style="height: 88%" title="Ven"></span>
                    <span style="height: 100%" title="Sam"></span>
                    <span style="height: 60%" title="Dim"></span>
                </div>
                <p class="muted small">Les volumes cumul√©s sont calcul√©s via les ventes saisies dans RestauBot.</p>
            </div>
            <div class="sales-table-wrapper">
                <table class="sales-table">
                    <thead>
                        <tr>
                            <th>Plat</th>
                            <th>Volumes</th>
                            <th>Ticket moyen</th>
                            <th>Conversion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Raviole de homard</td>
                            <td>54</td>
                            <td>42 ‚Ç¨</td>
                            <td><span class="trend-positive">+9 %</span></td>
                        </tr>
                        <tr>
                            <td>Risotto champignons anciens</td>
                            <td>68</td>
                            <td>36 ‚Ç¨</td>
                            <td><span class="trend-neutral">=</span></td>
                        </tr>
                        <tr>
                            <td>Crumble de poire Safran</td>
                            <td>34</td>
                            <td>18 ‚Ç¨</td>
                            <td><span class="trend-positive">+4 %</span></td>
                        </tr>
                        <tr>
                            <td>Tartare de maigre</td>
                            <td>36</td>
                            <td>38 ‚Ç¨</td>
                            <td><span class="trend-negative">-6 %</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>