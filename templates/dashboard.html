<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RestauBot | Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="apple-touch-icon" sizes="180x180" href="/static/icones/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static/icones/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/icones/favicon-16x16.png">
  <link rel="manifest" href="/static/icones/site.webmanifest">
  <link rel="stylesheet" href="/static/css/dashboard.css" />
  <link rel="stylesheet" href="/static/css/menu-upload-gallery.css" />
  <link rel="stylesheet" href="/static/css/menu-editor.css" />
  <!-- <link rel="stylesheet" href="/static/css/stock_management.css" /> -->
  <link rel="stylesheet" href="/static/css/purchasing/sales.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
  <script src="/static/js/supabaseClient.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>
  <script src="/static/js/menu-editor.js" defer></script>
  <script type="module" src="/static/js/dashboard.js?v=2"></script>
  <script src="/static/js/recipes.js" defer></script>
  <script src="/static/js/sales.js" defer></script>
</head>

<body>
  <div class="dashboard-loading-overlay" id="dashboard-loading-overlay" role="status" aria-live="polite"
    aria-busy="true">
    <div class="loading-indicator">
      <span class="loading-spinner" aria-hidden="true"></span>
      <p>Chargement des données du dashboard…</p>
    </div>
  </div>
  <div class="dashboard-loading-overlay is-hidden" id="selection-loading-overlay" role="status" aria-live="polite"
    hidden aria-busy="false">
    <div class="loading-indicator">
      <span class="loading-spinner" aria-hidden="true"></span>
      <p>Mise à jour des données du restaurant…</p>
    </div>
  </div>
  <div class="dashboard">
    {% include "components/sidebar.html" %}
    <div class="sidebar-backdrop" id="sidebar-backdrop" aria-hidden="true"></div>

    <main class="main">
      {% include "components/header.html" %}

      {% include "components/overview.html" %}
      {% include "components/restaurants.html" %}
      {% include "components/manage_restaurants.html" %}
      {% include "components/chatbot.html" %}
      {% include "components/stats.html" %}
      {% include "components/billing.html" %}
      {% include "components/profile.html" %}
      {% include "components/purchasing.html" %}

      {% if stock and stock.items %}
      <section class="dashboard-stock-section">
        <h2>Ingrédients critiques</h2>
        <ul>
          {% for item in stock.items if item.status == "critical" %}
          <li>
            <strong>{{ item.ingredient_name or "Ingrédient" }}</strong> :
            {{ item.current_stock }} / {{ item.safety_stock }}
          </li>
          {% else %}
          <li>Aucun ingrédient critique.</li>
          {% endfor %}
        </ul>
      </section>

      <section class="dashboard-stock-section">
        <h2>Ingrédients faibles</h2>
        <ul>
          {% for item in stock.items if item.status == "low" %}
          <li>
            <strong>{{ item.ingredient_name or "Ingrédient" }}</strong> :
            {{ item.current_stock }} / {{ item.safety_stock }}
          </li>
          {% else %}
          <li>Aucun ingrédient proche de la rupture.</li>
          {% endfor %}
        </ul>
      </section>

      <section class="dashboard-stock-section">
        <h2>Surplus</h2>
        <ul>
          {% for item in stock.items if item.status == "overstock" %}
          <li>
            <strong>{{ item.ingredient_name or "Ingrédient" }}</strong> :
            {{ item.current_stock }} / {{ item.safety_stock }}
          </li>
          {% else %}
          <li>Aucun ingrédient en surstock.</li>
          {% endfor %}
        </ul>
      </section>

      <section class="dashboard-stock-section">
        <h2>Vue d'ensemble du stock</h2>
        <ul>
          {% for item in stock.items %}
          <li>
            <strong>{{ item.ingredient_name or "Ingrédient" }}</strong> —
            statut : {{ item.status }}, stock : {{ item.current_stock }} / {{ item.safety_stock }}
          </li>
          {% else %}
          <li>Aucun ingrédient n'a été trouvé.</li>
          {% endfor %}
        </ul>
      </section>
      {% else %}
      <!-- Stock section intentionally hidden when no data -->
      {% endif %}
    </main>
  </div>

  {% include "components/modals.html" %}
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

</body>

</html>
